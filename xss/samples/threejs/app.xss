<!DOCTYPE html>

<html>

<head>

<title><xss:e value = "application.title"/></title>
<style type="text/css">
	body{
	 <xss:marker name="css_style"/>
	}
</style>
</head>

<body>
<script type="text/javascript" src="js/three/Detector.js"></script>
<script type="text/javascript" src="js/three/Three.js"></script>
<script type="text/javascript" src="js/three/Stats.js"></script>
<script type="text/javascript" src="js/three/RequestAnimationFrame.js"></script>

<xss:marker name="body"/>

<xss:code>
if(application.background)
	out(marker = "css_style"){
	background:<xss:e value = "application.background"/>;
	}
out(){
<script type="text/javascript">		
}
if(application.renderer=="webgl")
	out(){
	if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
	var renderer = new THREE.WebGLRenderer( { antialias: true } );
	}
if(application.renderer=="canvas")
	out(){
	var renderer = new THREE.CanvasRenderer();
	}
int sound_flag = 0; 
for(var res in application.resources){
	if(res.class == "sound" && sound_flag == 0){
		out(){	
		soundRenderer = new THREE.SoundRenderer();		
		document.body.appendChild( soundRenderer.domElement );
		}
		out(marker = "sound_render"){	
		soundRenderer.render( scene, camera );
		}
		sound_flag++;
	}
	if(res.class == "video"){
		out(marker = "body"){	
		<video id="<xss:e value = "res.id"/>" autoplay style="<xss:e value = "res.style"/>">
		}
		for(var child in res.children){
			out(marker = "body"){	
			<source src="<xss:e value = "child.src"/>" type='<xss:e value = "child.type"/>'>
			}
		}
		out(marker = "body"){	
		</video>
		}
	}
}
</xss:code>

renderer.setSize( window.innerWidth, window.innerHeight );
var application = this;
function render() {
	renderer.clear();	
	renderer.render( scene, camera );
	<xss:marker name="sound_render"/>
}

<xss:file output="inline" src="resources.xss"/>

<xss:file output="inline" src="scene.xss"/>

document.body.appendChild( renderer.domElement );
animate();

function animate() {
	requestAnimationFrame( animate );
	render();
}

</script>

</body>

</html>